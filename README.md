# KV_
KV_ 是一个高性能的键值存储服务器，使用纯C语言实现。它采用事件驱动的网络模型和零复制技术，能够实现每秒15万+次(本地测试)操作的高吞吐量。

## 特性

- **高性能**：使用零复制技术和最小化内存操作，每秒可处理超过15万次操作
- **多线程**：利用多核处理能力，实现高并发请求处理
- **事件驱动**：基于epoll的事件驱动架构，高效处理网络I/O
- **简单协议**：使用类似"长度:内容"格式的简单文本协议
- **线程安全**：完整的并发控制机制，保证数据一致性

## 性能测试

```
======= 测试结果比较 =======
操作类型     | 吞吐量 (ops/sec) | 成功率
-------------+------------------+--------
set         | 158,282.91       | 100.00%
get         | 150,570.07       | 100.00%
del         | 151,798.03       | 100.00%
mixed       | 150,036.25       | 100.00%
```

测试环境：本地环境，4线程，每线程25000操作

## 核心优化

本项目的主要性能提升来自以下几个关键优化：

1. **零复制技术**：通过直接引用原始数据而非复制数据，大幅减少内存操作开销
2. **FD缓冲区优化**：使用数组而非哈希表来管理文件描述符关联的缓冲区
3. **最小化内存分配**：减少内存分配和释放操作，降低系统调用开销
4. **高效的命令解析**：使用最小复制策略处理命令解析

## 支持的命令

- `SET key value` - 设置键值对
- `GET key` - 获取指定键的值
- `DEL key` - 删除指定键

## 构建与运行

### 依赖

- GCC
- CMake
- pthread

### 构建步骤

```bash
mkdir build
cd build
cmake ..
make
```

### 运行服务器

```bash
./kv_
```

默认监听端口为7000。

## 性能测试工具

项目包含一个Python实现的性能测试工具，可用于测试服务器性能：

```bash
python benchmark.py --host localhost --port 7000 --threads 4 --ops 100000 --type all
```

## 架构设计

KV_采用经典的事件驱动网络模型，主要组件包括：

- **事件循环**：基于epoll的事件监听和分发
- **命令处理器**：解析和执行客户端命令
- **存储引擎**：基于哈希表的键值存储
- **网络协议解析器**：零复制的协议解析实现
- **响应队列**：异步处理客户端响应

## 实现细节

### 零复制技术

传统实现中，解析客户端请求需要多次内存复制，是主要性能瓶颈。通过零复制技术，我们直接引用原始缓冲区中的数据，而不是复制到新的缓冲区，显著提高了性能。

### 事件驱动模型

使用epoll实现高效的事件监听，能够同时处理数千个连接而不会造成性能下降。

### 线程池

使用线程池处理请求，避免频繁创建和销毁线程的开销。

## 许可证

[MIT License](LICENSE)